<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YouFloww - Focus Timer</title>
<style>
/* Your existing CSS remains the same, with these additions */

/* Sound Library Styles */
.sound-library {
  display: none;
  margin: 20px 0;
  padding: 15px;
  background: rgba(255,255,255,0.7);
  border-radius: 10px;
}
.sound-item {
  display: flex;
  align-items: center;
  margin: 10px 0;
  padding: 10px;
  background: #f9f9f9;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.3s;
}
.sound-item:hover {
  background: #eaeaea;
}
.sound-item.playing {
  background: #e0f7fa;
}
.sound-item input[type="range"] {
  margin-left: auto;
  width: 100px;
}
</style>
</head>
<body>

<!-- Your existing HTML remains the same -->

<!-- Add this section after your timer buttons -->
<div>
  <button onclick="toggleSoundLibrary()">üéµ Sound Library</button>
</div>

<div id="soundLibrary" class="sound-library">
  <h3>Background Sounds</h3>
  <div class="sound-item" onclick="playSound('rain')">
    <span>üåßÔ∏è Rain</span>
    <input type="range" min="0" max="100" value="50" oninput="setVolume('rain', this.value)">
  </div>
  <div class="sound-item" onclick="playSound('forest')">
    <span>üå≤ Forest</span>
    <input type="range" min="0" max="100" value="50" oninput="setVolume('forest', this.value)">
  </div>
  <div class="sound-item" onclick="playSound('coffee')">
    <span>‚òï Coffee Shop</span>
    <input type="range" min="0" max="100" value="50" oninput="setVolume('coffee', this.value)">
  </div>
  <div class="sound-item" onclick="playSound('white')">
    <span>üéµ White Noise</span>
    <input type="range" min="0" max="100" value="50" oninput="setVolume('white', this.value)">
  </div>
  <button onclick="stopAllSounds()">Stop All Sounds</button>
</div>

<!-- Your existing modals and other HTML -->

<script>
// ---- Sound Library Functions ----
let currentSound = null;

function toggleSoundLibrary() {
  const library = document.getElementById('soundLibrary');
  library.style.display = library.style.display === 'none' ? 'block' : 'none';
}

function playSound(soundType) {
  // Stop any currently playing sound
  stopAllSounds();
  
  // Remove playing class from all items
  document.querySelectorAll('.sound-item').forEach(item => {
    item.classList.remove('playing');
  });
  
  // Set audio source based on selection
  const audio = new Audio();
  switch(soundType) {
    case 'rain':
      audio.src = 'https://assets.mixkit.co/sfx/preview/mixkit-rain-01-41.mp3';
      break;
    case 'forest':
      audio.src = 'https://assets.mixkit.co/sfx/preview/mixkit-forest-birds-1293.mp3';
      break;
    case 'coffee':
      audio.src = 'https://assets.mixkit.co/sfx/preview/mixkit-coffee-shop-ambience-444.mp3';
      break;
    case 'white':
      audio.src = 'https://assets.mixkit.co/sfx/preview/mixkit-wind-air-whistling-1461.mp3';
      break;
  }
  
  audio.loop = true;
  audio.volume = document.querySelector(`.sound-item:nth-child(${getSoundIndex(soundType)}) input`).value / 100;
  audio.play();
  
  currentSound = audio;
  
  // Add playing class to selected item
  event.currentTarget.classList.add('playing');
}

function getSoundIndex(soundType) {
  const sounds = ['rain', 'forest', 'coffee', 'white'];
  return sounds.indexOf(soundType) + 1;
}

function setVolume(soundType, value) {
  if (currentSound) {
    currentSound.volume = value / 100;
  }
}

function stopAllSounds() {
  if (currentSound) {
    currentSound.pause();
    currentSound = null;
  }
  
  // Remove playing class from all items
  document.querySelectorAll('.sound-item').forEach(item => {
    item.classList.remove('playing');
  });
}

// ---- Enhanced Weekly Stats ----
function updateWeeklyStats(minutes) {
  const today = new Date();
  const weekStart = getWeekStartDate(today);
  const weekKey = weekStart.toISOString().slice(0, 10);
  
  let weeklyStats = JSON.parse(localStorage.getItem("weeklyStats") || "[]");
  let weekData = weeklyStats.find(w => w.weekStart === weekKey);
  
  if (!weekData) {
    // Create new week entry
    weekData = {
      weekStart: weekKey,
      totalMinutes: 0,
      sessions: 0,
      daysActive: 0,
      days: {}  // New: Track minutes for each day
    };
    weeklyStats.push(weekData);
  }
  
  // Update week data
  weekData.totalMinutes += minutes;
  weekData.sessions += 1;
  
  // Track minutes by day
  const todayKey = today.toISOString().slice(0, 10);
  weekData.days[todayKey] = (weekData.days[todayKey] || 0) + minutes;
  
  // Update daysActive count
  weekData.daysActive = Object.keys(weekData.days).length;
  
  // Save updated stats
  localStorage.setItem("weeklyStats", JSON.stringify(weeklyStats));
}

// ---- Enhanced Chart Functions ----
function renderEnhancedBarChart() {
  const weeklyData = JSON.parse(localStorage.getItem("weeklyFocus") || "{}");
  const today = new Date();
  const labels = [];
  const data = [];
  
  // Get data for the last 7 days
  for (let i = 6; i >= 0; i--) {
    const day = new Date(today);
    day.setDate(today.getDate() - i);
    const key = day.toISOString().slice(0, 10);
    const dayName = day.toLocaleDateString('en-US', { weekday: 'short' });
    labels.push(dayName);
    // Convert minutes to hours with one decimal place
    data.push(((weeklyData[key] || 0) / 60).toFixed(1));
  }
  
  // Create bar chart using canvas
  const canvas = document.getElementById('barChart');
  const ctx = canvas.getContext('2d');
  
  // Clear canvas
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  // Set canvas dimensions
  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
  
  const maxValue = Math.max(...data, 1); // Avoid division by zero
  const barWidth = (canvas.width - 60) / data.length;
  const barSpacing = 10;
  
  // Draw grid lines
  ctx.strokeStyle = '#e0e0e0';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 5; i++) {
    const y = canvas.height - 40 - (i / 5) * (canvas.height - 60);
    ctx.beginPath();
    ctx.moveTo(30, y);
    ctx.lineTo(canvas.width - 20, y);
    ctx.stroke();
  }
  
  // Draw bars with gradient
  for (let i = 0; i < data.length; i++) {
    const barHeight = (data[i] / maxValue) * (canvas.height - 60);
    const x = 40 + i * (barWidth + barSpacing);
    const y = canvas.height - 40 - barHeight;
    
    // Create gradient
    const gradient = ctx.createLinearGradient(x, y, x, y + barHeight);
    gradient.addColorStop(0, '#4CAF50');
    gradient.addColorStop(1, '#2E7D32');
    
    // Draw bar with shadow
    ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
    ctx.shadowBlur = 4;
    ctx.shadowOffsetX = 2;
    ctx.shadowOffsetY = 2;
    ctx.fillStyle = gradient;
    ctx.fillRect(x, y, barWidth, barHeight);
    ctx.shadowBlur = 0;
    ctx.shadowOffsetX = 0;
    ctx.shadowOffsetY = 0;
    
    // Draw value text
    ctx.fillStyle = '#333';
    ctx.font = '12px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(data[i] + 'h', x + barWidth / 2, y - 8);
    
    // Draw label
    ctx.fillText(labels[i], x + barWidth / 2, canvas.height - 20);
  }
  
  // Draw Y-axis markers
  ctx.textAlign = 'right';
  ctx.textBaseline = 'middle';
  ctx.fillStyle = '#666';
  for (let i = 0; i <= 5; i++) {
    const value = (maxValue / 5 * i).toFixed(1);
    const y = canvas.height - 40 - (i / 5) * (canvas.height - 60);
    ctx.fillText(value + 'h', 35, y);
  }
  
  // Draw title
  ctx.textAlign = 'center';
  ctx.font = 'bold 14px Arial';
  ctx.fillStyle = '#333';
  ctx.fillText('Daily Focus (hours)', canvas.width / 2, 20);
}

// Update the renderCharts function to use the enhanced version
function renderCharts() {
  renderEnhancedBarChart();
  renderPieChart();
}

// Your existing JavaScript continues here...
</script>
</body>
</html>
