<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YouFloww - Focus Timer</title>
<style>
body {
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 50px;
    background: #f4f4f9;
    color: #333;
}
#timer { font-size: 4rem; margin: 20px 0; }
#status { font-size: 1.5rem; margin-bottom: 20px; color: #555; }
button {
    padding: 10px 20px; font-size: 1rem; margin: 5px;
    cursor: pointer; border: none; border-radius: 8px;
    background: #4CAF50; color: white; transition: background 0.3s ease;
}
button:hover { background: #45a049; }
button:disabled { background: #ccc; cursor: not-allowed; }

/* Modal Styles */
.modal {
    display: none; position: fixed; top: 0; left: 0;
    width: 100%; height: 100%; background: rgba(0,0,0,0.6);
    justify-content: center; align-items: center;
    z-index: 1000;
}
.modal-content {
    background: rgba(255,255,255,0.95); border-radius: 15px;
    padding: 30px; width: 90%; max-width: 600px;
    text-align: center; position: relative;
    background-size: cover; background-position: center; color: #222;
    max-height: 80vh; overflow-y: auto;
}
.close-btn { position: absolute; top: 10px; right: 15px; font-size: 1.5rem; cursor: pointer; color: #333; }

/* Chart Containers */
.chart-container {
    margin: 20px 0;
    background: rgba(255,255,255,0.7);
    padding: 15px;
    border-radius: 10px;
}
.chart-title {
    font-weight: bold;
    margin-bottom: 10px;
}
#barChart, #pieChart {
    width: 100%;
    height: 200px;
    margin: 10px 0;
}

/* Corner Widget */
#cornerWidget { position: fixed; bottom: 20px; right: 20px; background: rgba(255,255,255,0.9); padding: 10px; border-radius: 10px; width: 200px; font-size: 14px; text-align: center; }
#cornerWidget div { margin: 5px 0; }

/* Coin Popup */
#coinPopup {
    display:none; position: fixed; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: url('https://i.imgur.com/XyZBgXc.png') no-repeat center center;
    background-size: cover; padding: 30px; border-radius: 15px;
    color: white; font-size: 20px; text-align: center; z-index: 999;
}

/* Coin Counter and View Stats */
#coinContainer { position: fixed; top: 20px; right: 20px; text-align: center; }
#coinContainer button { margin-top:5px; }

/* Tabs for charts */
.tabs { display: flex; margin-bottom: 15px; }
.tab { flex: 1; padding: 8px; background: #ddd; cursor: pointer; }
.tab.active { background: #4CAF50; color: white; }

/* Stats table */
.stats-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
.stats-table th, .stats-table td { padding: 8px; text-align: center; border-bottom: 1px solid #ddd; }
.stats-table th { background-color: #f2f2f2; }
.stats-table tr:hover { background-color: #f5f5f5; }
</style>
</head>
<body>

<h1>Welcome to YouFloww ‚è±Ô∏è</h1>
<p>Stay focused. Stay consistent.</p>

<div id="status">Work Session</div>
<div id="timer">25:00</div>

<button id="startBtn" onclick="startTimer()">Start</button>
<button id="pauseBtn" onclick="pauseTimer()" disabled>Pause</button>
<button onclick="resetTimer()">Reset</button>
<button id="endSessionBtn" onclick="endSession()">End Session</button>

<!-- Coin Counter & Stats Button -->
<div id="coinContainer">
  <div>üí∞ Coins: <span id="coinCount">0</span></div>
  <button onclick="openStats()">View Stats</button>
</div>

<!-- Stats Modal -->
<div id="statsModal" class="modal">
  <div id="statsContent" class="modal-content">
    <span class="close-btn" onclick="closeStats()">&times;</span>
    <h2>Your Progress üìà</h2>
    <p id="streak">üî• Streak: 0 days</p>
    <p id="sessionsToday">üìä Sessions today: 0</p>
    <p id="weeklyFocus">‚è≥ Focused this week: 0h 0m</p>
    
    <!-- Chart Tabs -->
    <div class="tabs">
      <div class="tab active" onclick="switchTab('bar')">Weekly Focus</div>
      <div class="tab" onclick="switchTab('pie')">Session Distribution</div>
      <div class="tab" onclick="switchTab('history')">History</div>
    </div>
    
    <!-- Bar Chart Container -->
    <div id="barChartContainer" class="chart-container">
      <div class="chart-title">Daily Focus (hours)</div>
      <canvas id="barChart"></canvas>
    </div>
    
    <!-- Pie Chart Container -->
    <div id="pieChartContainer" class="chart-container" style="display:none">
      <div class="chart-title">Session Types</div>
      <canvas id="pieChart"></canvas>
    </div>
    
    <!-- History Table Container -->
    <div id="historyContainer" class="chart-container" style="display:none">
      <div class="chart-title">Weekly History</div>
      <table class="stats-table">
        <thead>
          <tr>
            <th>Week Starting</th>
            <th>Total Focus</th>
            <th>Sessions</th>
            <th>Days Active</th>
          </tr>
        </thead>
        <tbody id="historyTableBody">
          <!-- Will be populated by JavaScript -->
        </tbody>
      </table>
    </div>
    
    <button onclick="uploadStatsBackground()">Upload Background</button>
    <button onclick="exportData()" style="background: #2196F3;">Export Data</button>
    <button onclick="clearAllData()" style="background: #f44336;">Clear All Data</button>
  </div>
</div>

<!-- Coin Popup -->
<div id="coinPopup">
  +<span id="coinEarned">0</span> Coins!
</div>

<!-- Sounds -->
<audio id="coinSound">
  <source src="https://actions.google.com/sounds/v1/money/coin_drop.ogg" type="audio/ogg">
</audio>
<audio id="startSound">
  <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" type="audio/ogg">
</audio>
<audio id="endSound">
  <source src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" type="audio/ogg">
</audio>

<!-- Corner Widget -->
<div id="cornerWidget">
  <div id="liveTime"></div>
  <div>Day Progress</div>
  <div style="width:100%; background:#ccc; height:10px; border-radius:5px;">
    <div id="dayProgressBar" style="height:10px; width:0%; background:#4CAF50; border-radius:5px;"></div>
  </div>
  <div>Month Progress</div>
  <div style="width:100%; background:#ccc; height:6px; border-radius:3px;">
    <div id="monthProgressBar" style="height:6px; width:0%; background:#2196F3; border-radius:3px;"></div>
  </div>
  <div>Year Progress</div>
  <div style="width:100%; background:#ccc; height:6px; border-radius:3px;">
    <div id="yearProgressBar" style="height:6px; width:0%; background:#FF9800; border-radius:3px;"></div>
  </div>
</div>

<script>
// ---- Timer Variables ----
let timer, timeLeft = 25*60, isRunning = false, isWorkSession = true, sessionCount = 0;

// ---- Stats ----
let sessionsToday = parseInt(localStorage.getItem("sessionsToday")) || 0;
let streak = parseInt(localStorage.getItem("streak")) || 0;
let lastActiveDate = localStorage.getItem("lastActiveDate") || null;

// ---- Coins ----
let coins = parseInt(localStorage.getItem("coins")) || 0;
let sessionCoinsToday = parseInt(localStorage.getItem("sessionCoinsToday")) || 0;
document.getElementById("coinCount").textContent = coins;

const startSound = document.getElementById("startSound");
const endSound = document.getElementById("endSound");
const coinSound = document.getElementById("coinSound");

// Initialize weekly stats if not exists
if (!localStorage.getItem("weeklyStats")) {
    localStorage.setItem("weeklyStats", JSON.stringify([]));
}

// ---- Timer Functions ----
function updateTimerDisplay(){
  const minutes=Math.floor(timeLeft/60);
  const seconds=timeLeft%60;
  document.getElementById("timer").textContent=`${minutes}:${seconds<10?'0':''}${seconds}`;
}
function updateStatus(){ document.getElementById("status").textContent=isWorkSession?"Work Session":"Break Time"; }

function startTimer(){
  if(!isRunning){
    startSound.play();
    isRunning=true;
    document.getElementById("startBtn").disabled=true;
    document.getElementById("pauseBtn").disabled=false;
    timer=setInterval(()=>{
      if(timeLeft>0){ timeLeft--; updateTimerDisplay(); }
      else{
        clearInterval(timer);
        isRunning=false;
        document.getElementById("startBtn").disabled=false;
        document.getElementById("pauseBtn").disabled=true;
        endSound.play();
        handleSessionCompletion();
      }
    },1000);
  }
}
function endSession(){
    clearInterval(timer);
    isRunning = false;

    // Save partial session if >1 min
    if(timeLeft < 25*60 && timeLeft > 60){
        savePartialSession();
    }

    // Reset for next session
    timeLeft = 25*60;
    isWorkSession = true;
    sessionCount = 0;
    updateTimerDisplay();
    updateStatus();
    document.getElementById("startBtn").disabled = false;
    document.getElementById("pauseBtn").disabled = true;
}
    
function savePartialSession(){
    // Only count if at least 1 minute has passed
    const minutesFocused = Math.floor((25*60 - timeLeft)/60);
    if(minutesFocused >= 1){
        sessionsToday++;
        localStorage.setItem("sessionsToday", sessionsToday);
        checkStreak();
        addFocusMinutes(minutesFocused);

        // Reward proportional coins for partial session
        const coinsThisSession = Math.floor(minutesFocused/5) + sessionCoinsToday*5;
        coins += coinsThisSession;
        sessionCoinsToday++;
        localStorage.setItem("coins", coins);
        localStorage.setItem("sessionCoinsToday", sessionCoinsToday);
        document.getElementById("coinCount").textContent = coins;

        // Show coin popup
        const popup = document.getElementById("coinPopup");
        document.getElementById("coinEarned").textContent = coinsThisSession;
        popup.style.display = "block";
        coinSound.play();
        setTimeout(()=>{popup.style.display="none";},2000);
    }
}
function pauseTimer(){
    clearInterval(timer);
    isRunning = false;
    document.getElementById("startBtn").disabled = false;
    document.getElementById("pauseBtn").disabled = true;
}
    function resetTimer(){
    clearInterval(timer);
    isRunning=false;

    // Save partial session if >1 min
    if(timeLeft < 25*60 && timeLeft > 25){
        savePartialSession();
    }

    isWorkSession=true;
    sessionCount=0;
    timeLeft=25*60;
    updateTimerDisplay();
    updateStatus();
    document.getElementById("startBtn").disabled=false;
    document.getElementById("pauseBtn").disabled=true;
}
// ---- Session Completion ----
function handleSessionCompletion(){
  if(isWorkSession){
    sessionCount++;
    sessionsToday++;
    localStorage.setItem("sessionsToday", sessionsToday);
    checkStreak();
    addFocusMinutes(25);
    rewardCoins();
    if(sessionCount%4===0) timeLeft=15*60;
    else timeLeft=5*60;
    isWorkSession=false;
  }else{
    timeLeft=25*60;
    isWorkSession=true;
  }
  updateTimerDisplay();
  updateStatus();
}
function checkStreak(){
  const today = new Date().toDateString();
  if(lastActiveDate !== today){
    if(lastActiveDate){
      const yesterday = new Date();
      yesterday.setDate(yesterday.getDate() - 1);
      if(lastActiveDate === yesterday.toDateString()){
        streak++;
      } else {
        streak = 1;
      }
    } else {
      streak = 1;
    }
    lastActiveDate = today;
    localStorage.setItem("streak", streak);
    localStorage.setItem("lastActiveDate", lastActiveDate);
    sessionCoinsToday = 0;
    localStorage.setItem("sessionCoinsToday", sessionCoinsToday);
  }
}

// ---- Enhanced Weekly Focus Tracking ----
function addFocusMinutes(minutes){
  const today = new Date().toISOString().slice(0,10);
  let weeklyData = JSON.parse(localStorage.getItem("weeklyFocus") || "{}");
  weeklyData[today] = (weeklyData[today] || 0) + minutes;
  localStorage.setItem("weeklyFocus", JSON.stringify(weeklyData));
  
  // Update weekly stats
  updateWeeklyStats(minutes);
}

function updateWeeklyStats(minutes) {
  const today = new Date();
  const weekStart = getWeekStartDate(today);
  const weekKey = weekStart.toISOString().slice(0, 10);
  
  let weeklyStats = JSON.parse(localStorage.getItem("weeklyStats") || "[]");
  let weekData = weeklyStats.find(w => w.weekStart === weekKey);
  
  if (!weekData) {
    // Create new week entry
    weekData = {
      weekStart: weekKey,
      totalMinutes: 0,
      sessions: 0,
      daysActive: 0,
      lastUpdated: today.toISOString().slice(0, 10)
    };
    weeklyStats.push(weekData);
  }
  
  // Update week data
  weekData.totalMinutes += minutes;
  weekData.sessions += 1;
  
  // Check if this is a new day for this week
  if (weekData.lastUpdated !== today.toISOString().slice(0, 10)) {
    weekData.daysActive += 1;
    weekData.lastUpdated = today.toISOString().slice(0, 10);
  }
  
  // Save updated stats
  localStorage.setItem("weeklyStats", JSON.stringify(weeklyStats));
}

function getWeekStartDate(date) {
  const day = date.getDay(); // 0 (Sunday) to 6 (Saturday)
  const diff = date.getDate() - day + (day === 0 ? -6 : 1); // Adjust to Monday as start of week
  return new Date(date.setDate(diff));
}

function getWeeklyFocus(){
  const weeklyData = JSON.parse(localStorage.getItem("weeklyFocus") || "{}");
  const today = new Date();
  let totalMinutes = 0;
  for(let i=0; i<7; i++){
    const day = new Date(today);
    day.setDate(today.getDate() - i);
    const key = day.toISOString().slice(0,10);
    if(weeklyData[key]) totalMinutes += weeklyData[key];
  }
  const hours = Math.floor(totalMinutes / 60);
  const minutes = totalMinutes % 60;
  return {hours, minutes};
}

// ---- Stats Modal ----
function openStats(){
  const modal = document.getElementById("statsModal");
  modal.style.display = "flex";
  updateStatsModal();
  applySavedStatsBackground();
  renderCharts();
  updateHistoryTable();
  modal.onclick = function(e){
    if(e.target === modal) closeStats();
  }
}

function closeStats(){
  document.getElementById("statsModal").style.display = "none";
}

function updateStatsModal(){
  document.getElementById("streak").textContent = `üî• Streak: ${streak} days`;
  document.getElementById("sessionsToday").textContent = `üìä Sessions today: ${sessionsToday}`;
  const weeklyFocus = getWeeklyFocus();
  document.getElementById("weeklyFocus").textContent = `‚è≥ Focused this week: ${weeklyFocus.hours}h ${weeklyFocus.minutes}m`;
}

function uploadStatsBackground(){
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "image/*";
  input.onchange = (e) => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = () => {
      const modalContent = document.getElementById("statsContent");
      modalContent.style.backgroundImage = `url(${reader.result})`;
      modalContent.style.backgroundSize = "cover";
      modalContent.style.backgroundPosition = "center";
      localStorage.setItem("statsBackground", reader.result);
    }
    reader.readAsDataURL(file);
  }
  input.click();
}

function applySavedStatsBackground(){
  const savedBg = localStorage.getItem("statsBackground");
  if(savedBg){
    const modalContent = document.getElementById("statsContent");
    modalContent.style.backgroundImage = `url(${savedBg})`;
    modalContent.style.backgroundSize = "cover";
    modalContent.style.backgroundPosition = "center";
  }
}

// ---- Chart Functions ----
function renderCharts() {
  renderBarChart();
  renderPieChart();
}

function renderBarChart() {
  const weeklyData = JSON.parse(localStorage.getItem("weeklyFocus") || "{}");
  const today = new Date();
  const labels = [];
  const data = [];
  
  // Get data for the last 7 days
  for (let i = 6; i >= 0; i--) {
    const day = new Date(today);
    day.setDate(today.getDate() - i);
    const key = day.toISOString().slice(0, 10);
    const dayName = day.toLocaleDateString('en-US', { weekday: 'short' });
    labels.push(dayName);
    // Convert minutes to hours with one decimal place
    data.push(((weeklyData[key] || 0) / 60).toFixed(1));
  }
  
  // Create bar chart using canvas
  const canvas = document.getElementById('barChart');
  const ctx = canvas.getContext('2d');
  
  // Clear canvas
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  // Set canvas dimensions
  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
  
  const maxValue = Math.max(...data, 1); // Avoid division by zero
  const barWidth = (canvas.width - 40) / data.length;
  const barSpacing = 10;
  
  // Draw bars
  for (let i = 0; i < data.length; i++) {
    const barHeight = (data[i] / maxValue) * (canvas.height - 60);
    const x = 30 + i * (barWidth + barSpacing);
    const y = canvas.height - 40 - barHeight;
    
    // Draw bar
    ctx.fillStyle = '#4CAF50';
    ctx.fillRect(x, y, barWidth, barHeight);
    
    // Draw value text
    ctx.fillStyle = '#333';
    ctx.font = '12px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(data[i] + 'h', x + barWidth / 2, y - 5);
    
    // Draw label
    ctx.fillText(labels[i], x + barWidth / 2, canvas.height - 20);
  }
  
  // Draw Y-axis markers
  ctx.textAlign = 'right';
  ctx.textBaseline = 'middle';
  for (let i = 0; i <= 5; i++) {
    const value = (maxValue / 5 * i).toFixed(1);
    const y = canvas.height - 40 - (i / 5) * (canvas.height - 60);
    ctx.fillText(value + 'h', 25, y);
  }
}

function renderPieChart() {
  const weeklyData = JSON.parse(localStorage.getItem("weeklyFocus") || "{}");
  let totalMinutes = 0;
  
  // Calculate total minutes for the week
  for (const day in weeklyData) {
    totalMinutes += weeklyData[day];
  }
  
  // If no data, show empty chart
  if (totalMinutes === 0) {
    const canvas = document.getElementById('pieChart');
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.font = '14px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('No data available', canvas.width / 2, canvas.height / 2);
    return;
  }
  
  // Create pie chart using canvas
  const canvas = document.getElementById('pieChart');
  const ctx = canvas.getContext('2d');
  
  // Clear canvas
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  // Set canvas dimensions
  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
  
  const centerX = canvas.width / 2;
  const centerY = canvas.height / 2;
  const radius = Math.min(centerX, centerY) - 20;
  
  // Colors for different days
  const colors = [
    '#4CAF50', '#2196F3', '#FF9800', '#E91E63', 
    '#9C27B0', '#607D8B', '#FF5722'
  ];
  
  let startAngle = 0;
  let colorIndex = 0;
  
  // Draw pie slices
  for (const day in weeklyData) {
    const sliceAngle = (weeklyData[day] / totalMinutes) * 2 * Math.PI;
    
    ctx.beginPath();
    ctx.moveTo(centerX, centerY);
    ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
    ctx.closePath();
    
    ctx.fillStyle = colors[colorIndex % colors.length];
    ctx.fill();
    
    startAngle += sliceAngle;
    colorIndex++;
  }
  
  // Draw center circle for donut effect
  ctx.beginPath();
    ctx.arc(centerX, centerY, radius * 0.5, 0, 2 * Math.PI);
    ctx.fillStyle = 'white';
    ctx.fill();
  
  // Draw total in center (in hours)
  const hours = (totalMinutes / 60).toFixed(1);
  ctx.fillStyle = '#333';
  ctx.font = 'bold 14px Arial';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(`${hours}h`, centerX, centerY);
}

function updateHistoryTable() {
  const weeklyStats = JSON.parse(localStorage.getItem("weeklyStats") || "[]");
  const tableBody = document.getElementById("historyTableBody");
  tableBody.innerHTML = "";
  
  // Sort by week starting date (newest first)
  weeklyStats.sort((a, b) => new Date(b.weekStart) - new Date(a.weekStart));
  
  weeklyStats.forEach(week => {
    const hours = (week.totalMinutes / 60).toFixed(1);
    const row = document.createElement("tr");
    
    row.innerHTML = `
      <td>${formatDate(week.weekStart)}</td>
      <td>${hours}h</td>
      <td>${week.sessions}</td>
      <td>${week.daysActive}</td>
    `;
    
    tableBody.appendChild(row);
  });
  
  if (weeklyStats.length === 0) {
    tableBody.innerHTML = `<tr><td colspan="4">No data available yet</td></tr>`;
  }
}

function formatDate(dateString) {
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
}

function switchTab(tabName) {
  const tabs = document.querySelectorAll('.tab');
  const barContainer = document.getElementById('barChartContainer');
  const pieContainer = document.getElementById('pieChartContainer');
  const historyContainer = document.getElementById('historyContainer');
  
  tabs.forEach(tab => tab.classList.remove('active'));
  
  if (tabName === 'bar') {
    document.querySelector('.tab:nth-child(1)').classList.add('active');
    barContainer.style.display = 'block';
    pieContainer.style.display = 'none';
    historyContainer.style.display = 'none';
  } else if (tabName === 'pie') {
    document.querySelector('.tab:nth-child(2)').classList.add('active');
    barContainer.style.display = 'none';
    pieContainer.style.display = 'block';
    historyContainer.style.display = 'none';
  } else {
    document.querySelector('.tab:nth-child(3)').classList.add('active');
    barContainer.style.display = 'none';
    pieContainer.style.display = 'none';
    historyContainer.style.display = 'block';
  }
}

// ---- Data Management Functions ----
function exportData() {
  const weeklyFocus = JSON.parse(localStorage.getItem("weeklyFocus") || "{}");
  const weeklyStats = JSON.parse(localStorage.getItem("weeklyStats") || "[]");
  
  const data = {
    exportDate: new Date().toISOString(),
    weeklyFocus,
    weeklyStats,
    streak: localStorage.getItem("streak"),
    coins: localStorage.getItem("coins")
  };
  
  const dataStr = JSON.stringify(data, null, 2);
  const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
  
  const exportFileDefaultName = `youfloww-data-${new Date().toISOString().slice(0,10)}.json`;
  
  const linkElement = document.createElement('a');
  linkElement.setAttribute('href', dataUri);
  linkElement.setAttribute('download', exportFileDefaultName);
  linkElement.click();
}

function clearAllData() {
  if (confirm("Are you sure you want to clear all data? This cannot be undone!")) {
    localStorage.removeItem("weeklyFocus");
    localStorage.removeItem("weeklyStats");
    localStorage.removeItem("streak");
    localStorage.removeItem("lastActiveDate");
    localStorage.removeItem("sessionsToday");
    localStorage.removeItem("coins");
    localStorage.removeItem("sessionCoinsToday");
    
    // Reset variables
    sessionsToday = 0;
    streak = 0;
    lastActiveDate = null;
    coins = 0;
    sessionCoinsToday = 0;
    
    // Update UI
    document.getElementById("coinCount").textContent = coins;
    updateStatsModal();
    updateHistoryTable();
    
    alert("All data has been cleared.");
  }
}

// ---- Coin System ----
function rewardCoins(){
  const coinsThisSession = 5 + sessionCoinsToday*5;
  coins += coinsThisSession;
  sessionCoinsToday++;
  localStorage.setItem("coins", coins);
  localStorage.setItem("sessionCoinsToday", sessionCoinsToday);
  document.getElementById("coinCount").textContent = coins;

  const popup = document.getElementById("coinPopup");
  document.getElementById("coinEarned").textContent = coinsThisSession;
  popup.style.display = "block";
  coinSound.play();
  setTimeout(() => { popup.style.display = "none"; }, 2000);
}

// ---- Corner Widget: Time + Progress ----
function updateCornerWidget(){
  const now = new Date();

  // Live Time
  const hours = now.getHours().toString().padStart(2,'0');
  const minutes = now.getMinutes().toString().padStart(2,'0');
  const seconds = now.getSeconds().toString().padStart(2,'0');
  document.getElementById("liveTime").textContent = `${hours}:${minutes}:${seconds} ${now.toDateString()}`;

  // Day Progress
  const dayPercent = ((now.getHours()*60 + now.getMinutes()) / (24*60)) * 100;
  document.getElementById("dayProgressBar").style.width = dayPercent + "%";

  // Month Progress
  const totalDays = new Date(now.getFullYear(), now.getMonth()+1, 0).getDate();
  const monthPercent = (now.getDate() / totalDays) * 100;
  document.getElementById("monthProgressBar").style.width = monthPercent + "%";

  // Year Progress
  const startYear = new Date(now.getFullYear(), 0, 1);
  const endYear = new Date(now.getFullYear() + 1, 0, 1);
  const yearPercent = ((now - startYear) / (endYear - startYear)) * 100;
  document.getElementById("yearProgressBar").style.width = yearPercent + "%";
}

setInterval(updateCornerWidget, 1000);
updateTimerDisplay();
updateStatus();
updateCornerWidget();
window.addEventListener("beforeunload", function (e) {
    if(timeLeft < 25*60 && timeLeft > 60){ // If session >1 min but not full
        savePartialSession();
    }
});
</script>

</body>
</html>
